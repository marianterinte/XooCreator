/* Container */
.builder{
	--headerH: 52px;
	--carouselH: 84px;
	--actionH: 72px;
	--gap: 8px;
	--used: calc(var(--headerH) + var(--actionH) + (2 * var(--carouselH)) + (4 * var(--gap)));
	--contentH: calc(100dvh - var(--used));
	display:grid;
	gap: var(--gap);
	width:100vw;
	height:100dvh;
	margin:0;
	padding:0;
	grid-template-rows: var(--headerH) auto auto auto auto; /* header, top carousel, top preview, bottom preview, bottom carousel */
	overflow:hidden;
}
.page-header{display:flex;align-items:center;justify-content:space-between;padding:6px 8px}
.spacer{flex:1}
.credits{font-weight:600;color:#111;text-align:center;min-width:120px}
.btn-icon{appearance:none;border:none;background:#4F46E5;color:#fff;border-radius:999px;width:44px;height:44px;display:grid;place-items:center;font-size:1.15rem;cursor:pointer;box-shadow:0 2px 6px rgba(79,70,229,.35)}
.btn-icon:hover{background:#4338CA}
.btn-icon:active{transform:translateY(1px)}
.btn-icon.back{justify-self:flex-start}
.btn-icon.help{justify-self:flex-end}
.page-header h1{margin:0;text-align:center;font-size:1.05rem}

/* Panels */
.panel{display:grid;gap: var(--gap)}
.panel-top{min-height:0}
.panel-bottom{min-height:0}
.section-header h2{margin:0;font-size:1rem}

/* (Legacy chips removed in this iteration, keep styles in case we want them back) */
/* .bp-slots{display:flex;gap:8px;overflow:auto;padding:4px 2px}
.bp-chip{flex:0 0 auto;min-height:36px;min-width:56px;padding:8px 12px;border:1px solid #ddd;border-radius:999px;background:#fff;cursor:pointer}
.bp-chip.selected{border-color:#4F46E5;box-shadow:0 0 0 3px rgba(79,70,229,.12)} */

/* Media preview panels */
.media-row{display:grid;grid-template-columns:1fr;align-items:center;gap:8px}
.preview{position:relative;margin:0;display:block;height:calc(var(--contentH) / 2);overflow:hidden;touch-action:pan-y}
.panel-top .preview{height:calc(var(--contentH) / 2)}
.panel-bottom .preview{height:calc(var(--contentH) / 2)}
.preview.dragging{transition:none}
.preview img{width:100vw;height:100%;object-fit:cover;display:block;user-select:none;-webkit-user-drag:none;pointer-events:none}

.preview-caption{position:absolute;left:8px;bottom:8px;background:rgba(0,0,0,.5);color:#fff;font-size:.85rem;padding:4px 8px;border-radius:999px}
.preview.locked::after{content:"";position:absolute;inset:0;background:linear-gradient(transparent, rgba(0,0,0,.25));pointer-events:none}
.lock-overlay{position:absolute;right:8px;top:8px;background:rgba(0,0,0,.6);color:#fff;border-radius:999px;padding:8px 12px;font-size:1.4rem;box-shadow:0 2px 8px rgba(0,0,0,.25)}
@media (min-width: 768px){
	.lock-overlay{font-size:1.6rem;padding:10px 14px}
}

/* Thumb carousels */
.carousel.thumbs{display:flex;gap:8px;overflow-x:auto;overflow-y:hidden;padding:8px;height:var(--carouselH);justify-content:flex-start;align-items:center;-webkit-overflow-scrolling:touch;overscroll-behavior-x:contain;touch-action:pan-x}
.carousel.thumbs::-webkit-scrollbar{height:6px}
.thumb{flex:0 0 auto;border:none;background:transparent;padding:0;cursor:pointer;position:relative;touch-action:manipulation}
.thumb img{width:68px;height:68px;object-fit:cover;border-radius:10px;border:1px solid #ddd;background:#fff}
.thumb.active img{outline:2px solid #4F46E5;box-shadow:0 0 0 3px rgba(79,70,229,.12)}
.thumb.locked img{filter:grayscale(0.4);opacity:.7}
.badge-lock{position:absolute;right:4px;top:4px;background:rgba(0,0,0,.6);color:#fff;border-radius:8px;padding:2px 6px;font-size:.75rem}

.hint{margin:6px 0 0 0;color:#666;font-size:.85rem}

/* Action bar */
.action-bar{position:fixed;left:0;right:0;bottom:0;padding:8px 8px calc(8px + env(safe-area-inset-bottom));background:linear-gradient(180deg, rgba(255,255,255,0), #fff 30%)}
.btn-generate{width:min(640px, 92vw);min-height:48px;border:none;border-radius:12px;background:#4F46E5;color:#fff;font-size:1rem;cursor:pointer;display:block;margin:0 auto}
.btn-generate:hover{background:#4338CA}
.btn-unlock{width:min(640px, 92vw);min-height:48px;border:none;border-radius:12px;background:#059669;color:#fff;font-size:1rem;cursor:pointer;display:block;margin:0 auto}
.btn-unlock:hover{background:#047857}

/* Larger screens keep full-bleed images but slightly bigger thumbs */
@media (min-width: 768px){
	.thumb img{width:80px;height:80px}
}

/* Modal */
.confirm-modal{
	border:none;border-radius:28px;padding:24px;max-width:none;
	width:90vw;height:90dvh;
	box-shadow:0 20px 60px rgba(0,0,0,.28);
	display:flex;flex-direction:column;overflow:hidden;
	position:fixed;inset:0;margin:auto;
	background:
		radial-gradient(ellipse at 20% -10%, rgba(255,255,255,.6), rgba(255,255,255,0) 60%),
		radial-gradient(ellipse at 120% 10%, rgba(255,255,255,.6), rgba(255,255,255,0) 60%),
		linear-gradient(135deg, #fef3c7, #e9d5ff, #bfdbfe, #bbf7d0);
	background-size: auto, auto, 300% 300%;
	animation: modal-pop-in 220ms cubic-bezier(.2,.7,.3,1) both, gradientShift 10s ease-in-out infinite alternate;
}
.confirm-modal.tutorial{height:54dvh}
.confirm-modal.compact{height:54dvh}
.confirm-modal:not([open]){display:none !important}
.confirm-modal[open]{animation: modal-pop-in 220ms cubic-bezier(.2,.7,.3,1) both}
.confirm-modal::backdrop{background:radial-gradient(circle at center, rgba(0,0,0,.45), rgba(0,0,0,.65));animation: backdrop-fade-in 220ms ease-out both}
.confirm-modal h3{margin:0 0 12px 0;font-size:1.35rem}
.confirm-modal .summary{flex:1 1 auto;min-height:0;overflow:auto;margin:12px 0;font-size:1.05rem;line-height:1.5}
.confirm-modal ul{margin:0;padding-left:18px}
.confirm-modal ol{margin:0;padding-left:18px}
.confirm-modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
.btn.primary{background:#4F46E5;color:white;border:none;border-radius:10px;padding:8px 12px}
.confirm-modal.tutorial .btn.primary{color:#fff}
.btn.secondary{background:#f3f4f6;color:#111;border:none;border-radius:10px;padding:8px 12px}
.btn.unlock{background:#059669;color:#fff;border:none;border-radius:10px;padding:8px 12px}
.btn.unlock:hover{background:#047857}
.confirm-modal .warning{margin:8px 0 0 0;color:#b45309;background:#fff7ed;border:1px solid #fed7aa;padding:8px 10px;border-radius:10px}
.confirm-modal .touch-checkbox{width:28px;height:28px}
.confirm-modal li.disabled{opacity:.6;cursor:not-allowed}

/* Result modal: progress */
.confirm-modal.result .progress-wrap{display:grid;gap:12px;place-items:center;margin-top:8px}
.confirm-modal.result .progress-bar{width:100%;height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
.confirm-modal.result .progress-bar .fill{height:100%;background:linear-gradient(90deg,#4F46E5,#06b6d4);width:0;transition:width .35s ease}
.confirm-modal.result .status{margin:0;color:#374151}

/* Flip card */
.confirm-modal.result .result-card{position:relative;width:min(420px,80vw);height:min(560px,62vh);margin:12px auto;transform-style:preserve-3d;transition:transform .6s cubic-bezier(.2,.7,.3,1);cursor:pointer}
.confirm-modal.result .result-card.flipped{transform:rotateY(180deg)}
.confirm-modal.result .card-face{position:absolute;inset:0;backface-visibility:hidden;border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.2);display:grid;place-items:center}
.confirm-modal.result .card-face.front{background:#000}
.confirm-modal.result .card-face.front img{width:100%;height:100%;object-fit:cover}
.confirm-modal.result .card-face.front .flip-hint{position:absolute;left:12px;top:12px;background:rgba(0,0,0,.6);color:#fff;padding:6px 10px;border-radius:10px}
.confirm-modal.result .card-face.front .flip-hint.large{font-size:1.05rem;padding:8px 12px;box-shadow:0 2px 8px rgba(0,0,0,.3)}
.confirm-modal.result .card-face.back{transform:rotateY(180deg);background:#fff;display:flex}
.confirm-modal.result .card-face.back .details{padding:16px;display:grid;gap:8px;align-content:start}
.confirm-modal.result .card-face.back .res-name{margin:0;font-size:1.4rem}
.confirm-modal.result .card-face.back .res-story{margin:0;color:#374151;line-height:1.5}

@keyframes modal-pop-in{
	from{opacity:0;transform:translateY(8px) scale(.96)}
	to{opacity:1;transform:translateY(0) scale(1)}
}
@keyframes backdrop-fade-in{
	from{opacity:0}
	to{opacity:1}
}
@keyframes gradientShift{
	from{background-position: left top, right top, 0% 0%}
	to{background-position: left top, right top, 100% 100%}
}
